/*!
  * genomicRegion component v1.0.0
  * Copyright 2020 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
function compareRegions(t,s){let n=0;return t.start<s.start?n=-1:t.start>s.start?n=1:t.end<s.end?n=-1:t.end>s.end&&(n=1),n}class GenomicList extends Array{constructor(t){super(...t),this.sort()}push(t){super.push(t),this.sort()}sort(){super.sort(compareRegions)}splice(){throw"invalid method in GenomicList"}unshift(){throw"invalid method in GenomicList"}reverse(){throw"invalid method in GenomicList"}map(t){let s=[];return this.forEach(n=>s.push(t(n))),s}trimmed(t=null,s=null){0!=this.length&&(null==t&&(t=this[0].start),null==s&&(s=this[this.length].end));let n=new Array;return this.forEach(function(r){if(r.end>=t&&r.start<=s){if(r.start<t||r.end>s){let n=Object.getPrototypeOf(r).constructor.fromJSON(JSON.parse(JSON.stringify(r)));r.start<t&&(n.start=t),r.end>s&&(n.end=s),r=n}n.push(r)}}),new GenomicList(n)}}class Region{constructor(t,s,n,r=null,e={}){this.name=r,this.start=t,this.end=s,this.strand=n,this.annot=e}static fromJSON(t){let s=new Region;return Object.keys(t).forEach(function(n){null!=t[n]&&s.hasOwnProperty(n)&&(s[n]=t[n])}),s}}class LightRegion{constructor(t){this.pos=t}get start(){return this.pos[0]}set start(t){this.pos[0]=t}get end(){return this.pos[1]}set end(t){this.pos[1]=t}static fromJSON(t){return new LightRegion(t)}toJSON(){return this.pos}}class Protein extends Region{static fromJSON(t){let s=new Protein;return Object.keys(t).forEach(function(n){null!=t[n]&&s.hasOwnProperty(n)&&(s[n]=t[n])}),s}}class Exon extends Region{static fromJSON(t){let s=new Exon;return Object.keys(t).forEach(function(n){null!=t[n]&&s.hasOwnProperty(n)&&(s[n]=t[n])}),s}}class Transcript{constructor(t,s=[],n=null,r=null,e=null,i=null,o={}){this.name=t,this.exons=s,this.proteins=n,this._start=r,this._end=e,this._strand=i,this.annot=o}get start(){return null==this._start?this.exons[0].start:this._start}get end(){return null==this._end?this.exons[this.exons.length-1].end:this._end}get strand(){return null==this._strand?this.exons[0].strand:this._strand}set exons(t){this._exons=new GenomicList(t)}get exons(){return this._exons}set proteins(t){this._proteins=null==t?null:new GenomicList(t)}get proteins(){return this._proteins}static fromJSON(t){let s=new Transcript;return Object.keys(t).forEach(function(n){if(null!=t[n])if("exons"==n||"_exons"==n){let r=[];t[n="exons"].forEach(t=>r.push(Exon.fromJSON(t))),s.exons=r}else if("proteins"==n){let r=[];t[n].forEach(t=>r.push(Protein.fromJSON(t))),s.proteins=r}else s.hasOwnProperty(n)?s[n]=t[n]:s.hasOwnProperty("_"+n)&&(s["_"+n]=t[n])}),s}}class Gene{constructor(t,s=[],n=null,r=null,e=null,i={}){this.name=t,this.transcripts=s,this._start=n,this._end=r,this._strand=e,this.annot=i}get start(){return null==this._start?Math.min(...this.transcripts.map(t=>t.start)):this._start}get end(){return null==this._end?Math.max(...this.transcripts.map(t=>t.end)):this._end}get strand(){return null==this._strand?this.transcripts[0].strand:this._strand}set transcripts(t){this._transcripts=new GenomicList(t)}get transcripts(){return this._transcripts}static fromJSON(t){let s=new Gene;return Object.keys(t).forEach(function(n){if(null!=t[n])if("transcripts"==n||"_transcripts"==n){let r=[];t[n="transcripts"].forEach(t=>r.push(Transcript.fromJSON(t))),s.transcripts=r}else s.hasOwnProperty(n)?s[n]=t[n]:s.hasOwnProperty("_"+n)&&(s["_"+n]=t[n])}),s}}


/*!
  * AnaCore-web curation v1.0.0
  * Copyright 2022 CHU-Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
class AlterationCuration{constructor(t,i=null,s=null,e=null,a=null,l=null){this.author=s,this.clinical_impl=i||[],this.date=l||new Date,this.description=e,this.status=t,this.subject=a}toJSON(){return{author:this.author,clinical_impl:this.clinical_impl,date:this.date.getTime()/1e3,description:this.description,status:this.status,subject:this.subject}}static fromJSON(t){let i=new AlterationCuration(t.status);return Object.keys(t).forEach(function(s){i[s]="date"!=s?t[s]:new Date(1e3*t[s])}),i}}


/*!
  * AnaCore-web fusions v2.2.0
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
class Fusion{constructor(t,n,e,s,r=null,a=null){this.annotations=e,this.breakends=t,this.curations=a||[],this.filters=s,this.known_partners=r||{},this.supports=n}get sources(){let t=Object.keys(this.supports.by_src);return t.sort(),t}get hasInFrame(){let t={true:0,false:0,".":0};this.annotations.forEach(function(n){t[n.inframe]+=1});let n=!1;return t[!0]>0?n=!0:t["."]>0&&(n=null),n}getBNDGenesNames(t){let n=new Set;return this.breakends[t].features.forEach(t=>{null!=t.SYMBOL?n.add(t.SYMBOL):null!=t.Gene&&n.add(t.Gene)}),(n=Array.from(n)).sort(),n}getBNDSymbols(t){let n=new Set;return this.breakends[t].features.forEach(t=>{null!=t.SYMBOL&&n.add(t.SYMBOL)}),(n=Array.from(n)).sort(),n}getGenesNamesString(){return this.getBNDGenesNames(0).join(",")+" @ "+this.getBNDGenesNames(1).join(",")}getHumanBreakpoints(){const t=this.breakends[0].coordinates,n=this.breakends[1].coordinates;return[`${t.region}:${t.pos}(${t.strand})`,`${n.region}:${n.pos}(${n.strand})`]}getLastCuration(){let t=null,n=0;return this.curations.forEach(function(e){e.date>n&&(t=e,n=e.date)}),t}getJunctionsTypesPairs(){let t=[];return this.annotations.forEach(function(n){const e=n.features_annotation[0],s=n.features_annotation[1],r=e?e.RNA_ELT_TYPE:"no_feature",a=s?s.RNA_ELT_TYPE:"no_feature";t.push(r+" to "+a)}),(t=Array.from(new Set(t))).sort(),t}toJSON(){return{annotations:this.annotations.map(t=>({features_annotation:t.features_annotation.map(t=>t._id),inframe:t.inframe})),breakends:this.breakends,curations:this.curations.map(t=>t.toJSON()),filters:this.filters,known_partners:this.known_partners,supports:this.supports}}static fromJSON(t){const n=[Object.assign({},...t.breakends[0].features.map(t=>({[t._id]:t}))),Object.assign({},...t.breakends[1].features.map(t=>({[t._id]:t})))];t.annotations.forEach(function(t){t.features_annotation.forEach(function(e,s){t.features_annotation[s]=n[s][e]})});let e={};t.hasOwnProperty("known_partners")&&(e=t.known_partners);let s=[];return t.hasOwnProperty("curations")&&t.curations.forEach(function(t){s.push(AlterationCuration.fromJSON(t))}),new Fusion(t.breakends,t.supports,t.annotations,t.filters,e,s)}}class FusionInspectAnalysis{constructor(t,n=null,e={}){this.gene_by_id=t,this.parameters=e,this.targets_by_chr=n}static fromJSON(t){let n={};for(const[e,s]of Object.entries(t.gene_by_id))n[e]=Gene.fromJSON(s);let e=null;if(null!=t.targets_by_chr){e={};for(const[n,s]of Object.entries(t.targets_by_chr))e[n]=new GenomicList(s.map(t=>new LightRegion(t)))}return new FusionInspectAnalysis(n,e,t.parameters)}}


/*!
  * AnaCore-web dynamicTable component v1.11.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const DynamicTableHeader=Vue.component("dynamic-table-header",{props:{header:{required:!0,type:Array}},computed:{cleaned_header:function(){let e=this.header;return this.is_multi_rows||(e=new Array(e)),e},is_multi_rows:function(){return 0!==this.header.length&&Array.isArray(this.header[0])}},filters:{getRowSpan:function(e){return e.hasOwnProperty("rowspan")?e.rowspan:1},getColSpan:function(e){return e.hasOwnProperty("colspan")?e.colspan:1}},template:'<thead>\n            <tr v-for="row in cleaned_header">\n                <th v-for="col in row"\n                    :rowspan="col | getRowSpan"\n                    :colspan="col | getColSpan"\n                    data-toggle="popover"\n                    :data-content="col.help">\n                    {{col.title}}\n                </th>\n            </tr>\n        </thead>'}),DynamicTableCell=Vue.component("dynamic-table-cell",{props:{col:{required:!0,type:Object},entry:{required:!0,type:Object}},methods:{getValue:function(e,t){return this.$options.filters.getValue(e,t)}},filters:{getValue:function(e,t){let n=null;return t.hasOwnProperty("value")?n=t.value(e):e.hasOwnProperty(t.title)&&(n=e[t.title]),t.hasOwnProperty("displayFormat")&&(n=t.displayFormat(n)),n},getHref:function(e,t){return t.href(e)},getClass:function(e,t){let n=null;return t.hasOwnProperty("class")&&(n=[t.class]),t.hasOwnProperty("entryClass")&&(added_class=t.entryClass(e),null===n?n=[added_class]:n.push(added_class)),n},getEntryInnerClass:function(e,t){let n=null;return t.hasOwnProperty("entryInnerClass")&&(n=[t.entryInnerClass(e)]),n},getSubClass:function(e,t){let n=null;return t.hasOwnProperty("subEntryClass")&&(added_class=t.subEntryClass(e),null===n?n=[added_class]:n.push(added_class)),n},getSubHref:function(e,t){return t.subEntryHref(e)},getSubSeparator:function(e){let t=" ";return e.hasOwnProperty("subEntrySeparator")&&(t=e.subEntrySeparator),t}},template:'<td :class="entry | getClass(col)">\n            <template v-if="col.is_html">\n                <span v-html="getValue(entry, col)" v-on:click="col.event ? $emit(\'click\', entry) : null"></span>\n            </template>\n            <template v-else>\n                <template v-if="col.href">\n                    <a\n                        :target="col.href_target ? col.href_target : \'_self\'"\n                        :href="entry | getHref(col)"\n                        :class="entry | getEntryInnerClass(col)">\n                        <template v-if="col.is_array">\n                            <template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n                                <span v-if="sub_idx != 0">{{col | getSubSeparator}}</span><span :class="sub_value | getSubClass(col)">{{sub_value}}</span>\n                            </template>\n                        </template>\n                        <template v-else>\n                            {{entry | getValue(col)}}\n                        </template>\n                    </a>\n                </template>\n                <template v-else>\n                    <span :class="entry | getEntryInnerClass(col)">\n                        <template v-if="col.is_array">\n                            <template v-if="col.subEntryHref">\n                                <template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n                                    <span v-if="sub_idx != 0">{{col | getSubSeparator}}</span>\n                                    <a\n                                        :target="col.href_target ? col.href_target : \'_self\'"\n                                        :href="sub_value | getSubHref(col)"\n                                        :class="sub_value | getSubClass(col)">{{sub_value}}</a>\n                                </template>\n                            </template>\n                            <template v-else>\n                                <template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n                                    <span v-if="sub_idx != 0">{{col | getSubSeparator}}</span>\n                                    <span :class="sub_value | getSubClass(col)">{{sub_value}}</span>\n                                </template>\n                            </template>\n                        </template>\n                        <template v-else>\n                            {{entry | getValue(col)}}\n                        </template>\n                    </span>\n                </template>\n            </template>\n        </td>'}),DynamicTable=Vue.component("dynamic-table",{props:{data:Array,export_title:{default:null,type:String},filters:{default:null,type:Object},header:{required:!0,type:Array},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},pagination_sizes:{default:function(){return[10,25,50,100]},array:Array},scroll_x:{default:!1,type:Boolean},scroll_x_fix:{default:0,type:Number},title:String},data:function(){return{error_msg:null}},watch:{data:function(e,t){this.error_msg=null},filters:function(e,t){this.error_msg=null}},mounted:function(){if("TABLE"==$(this.$el)[0].tagName){const e=$(this.$el).DataTable(this.datatableParams);$(e.table().container()).find('[data-toggle="popover"]').popover({container:"body",trigger:"hover",html:!0})}},beforeUpdate:function(){"TABLE"==$(this.$el)[0].tagName&&$(this.$el).DataTable().destroy()},updated:function(){if("TABLE"==$(this.$el)[0].tagName){const e=$(this.$el).DataTable(this.datatableParams);$(e.table().container()).find('[data-toggle="popover"]').popover({container:"body",trigger:"hover",html:!0})}},computed:{is_multi_rows_header:function(){return 0!==this.header.length&&Array.isArray(this.header[0])},nb_columns:function(){let e=0,t=this.header;return this.is_multi_rows_header&&(t=this.header[0]),t.forEach(function(t){t.hasOwnProperty("colspan")?e+=t.colspan:e+=1}),e},header_mask:function(){let e=this.header;if(this.is_multi_rows_header){const t=this.header.length,n=this.nb_columns;(e=new Array(t).fill([])).forEach(function(t,l){e[l]=new Array(n).fill(null)}),this.header.forEach(function(t,n){col_idx=0,t.forEach(function(t){for(;null!==e[n][col_idx];)col_idx+=1;colspan=t.hasOwnProperty("colspan")?t.colspan:1,rowspan=t.hasOwnProperty("rowspan")?t.rowspan:1;for(let l=n;l<n+rowspan;l++)for(let n=col_idx;n<col_idx+colspan;n++)e[l][n]=t;col_idx+=1})})}return e},columns:function(){let e=this.header_mask;return this.is_multi_rows_header&&(e=e[e.length-1]),e},filteredData:function(){let e=this.data;if(null!=this.filters){const t=this;try{e=e.filter(function(e){return t.filters.eval(e)})}catch(e){this.error_msg="Error in data when apply filters."}}return e},datatableParams:function(){order_rule=[[0,"asc"]],this.columns.forEach(function(e,t){e.hasOwnProperty("sort")&&(order_rule=[[t,e.sort]])});let e={dom:"",order:order_rule,lengthMenu:this.pagination_sizes};return this.scroll_x&&(e.scrollX=!0,0!=this.scroll_x_fix&&(e.fixedColumns={leftColumns:this.scroll_x_fix})),this.menu.pagination&&(this.menu.filter&&(e.dom="f"),this.menu.export?e.dom="<'d-md-none'<'row'<'col-sm-12'B><'col-sm-12'l><'col-sm-12'"+e.dom+"r>>><'d-none d-md-block'<'row'<'col-md-6'<'row'<'dtable-head-btn'B>l>><'col-md-6'"+e.dom+"r>>><'row'<'col-sm-12't>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>":e.dom="<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'"+e.dom+"r>><'row'<'col-sm-12't>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>"),this.menu.export&&(null===this.export_title?e.buttons=["csv","excel"]:e.buttons=[{extend:"csv",title:this.export_title},{extend:"excel",title:this.export_title}]),e},datatableStyle:function(){let e={};return this.scroll_x&&(e={width:"100%","border-bottom":"none"}),e}},template:'<template v-if="error_msg !== null">\n            <div class="dtable-error-msg">\n                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n                    <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>\n                </svg>\n                {{error_msg}}\n            </div>\n        </template>\n        <template v-else>\n            <table class="table table-striped" :style="datatableStyle">\n                <caption v-if="title">\n                    {{title}}\n                </caption>\n                <dynamic-table-header :header="header"></dynamic-table-header>\n                <tbody>\n                    <tr v-for="entry in filteredData">\n                        <dynamic-table-cell v-for="(col, col_idx) in columns"\n                            v-on:click="col.event ? $emit(col.event, entry) : null"\n                            :entry="entry"\n                            :col="col"\n                        ></dynamic-table-cell>\n                    </tr>\n                </tbody>\n            </table>\n        </template>'});


/*!
  * AnaCore-web fusionDetailsTable component v1.0.1
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const fdetails_table_header=function(){return[{title:"Feature 1",value:function(t){let n="no_feature";const e=t.features_annotation[0];return e&&(n=`${e.Feature} (${e.SYMBOL})`),n}},{title:"Feature 2",value:function(t){let n="no_feature";const e=t.features_annotation[1];return e&&(n=`${e.Feature} (${e.SYMBOL})`),n}},{title:"Junction type",value:function(t){let n=[];for(const e of t.features_annotation){let t="no_feature";e&&(t=e.RNA_ELT_TYPE),n.push(t)}return n.join(" to ")}},{title:"Frame 2 status",value:function(t){return{null:"",true:"keep_frame",false:"shift"}[t.inframe]}},{title:"Location 1",value:function(t){let n="no_feature";const e=t.features_annotation[0];if(e){const t=e.RNA_ELT_TYPE.split("&")[0],o=e.RNA_ELT_POS.split("&")[0];let a=`CDS: ${e.CDS_position} and protein: ${e.Protein_position}`;e.RNA_ELT_POS.endsWith("prim")&&(a=e.RNA_ELT_POS.split("&")[1]),n=`${t} ${o} (${a})`}return n}},{title:"Location 2",value:function(t){let n="no_feature";const e=t.features_annotation[1];if(e){const t=e.RNA_ELT_TYPE.split("&")[0],o=e.RNA_ELT_POS.split("&")[0];let a=`CDS: ${e.CDS_position} and protein: ${e.Protein_position}`;e.RNA_ELT_POS.endsWith("prim")&&(a=e.RNA_ELT_POS.split("&")[1]),n=`${t} ${o} (${a})`}return n}},{title:"Strand 1",value:function(t){const n=t._strand_bnd_1;let e=".";const o=t.features_annotation[0];return o&&o.STRAND&&(e=o.STRAND),`${n}/${e}`}},{title:"Strand 2",value:function(t){const n=t._strand_bnd_2;let e=".";const o=t.features_annotation[1];return o&&o.STRAND&&(e=o.STRAND),`${n}/${e}`}}]};FusionDetailsTable=Vue.component("fusion-details-table",{props:{data:{default:null,type:Object},export_title:String,filters:{default:null,type:Object},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},scroll_x:{default:!0,type:Boolean},title:{default:"Fusion detail",type:String}},computed:{header:function(){return[{title:"Feature 1",value:function(t){let n="no_feature";const e=t.features_annotation[0];return e&&(n=`${e.Feature} (${e.SYMBOL})`),n}},{title:"Feature 2",value:function(t){let n="no_feature";const e=t.features_annotation[1];return e&&(n=`${e.Feature} (${e.SYMBOL})`),n}},{title:"Junction type",value:function(t){let n=[];for(const e of t.features_annotation){let t="no_feature";e&&(t=e.RNA_ELT_TYPE),n.push(t)}return n.join(" to ")}},{title:"Frame 2 status",value:function(t){return{null:"",true:"keep_frame",false:"shift"}[t.inframe]}},{title:"Location 1",value:function(t){let n="no_feature";const e=t.features_annotation[0];if(e){const t=e.RNA_ELT_TYPE.split("&")[0],o=e.RNA_ELT_POS.split("&")[0];let a=`CDS: ${e.CDS_position} and protein: ${e.Protein_position}`;e.RNA_ELT_POS.endsWith("prim")&&(a=e.RNA_ELT_POS.split("&")[1]),n=`${t} ${o} (${a})`}return n}},{title:"Location 2",value:function(t){let n="no_feature";const e=t.features_annotation[1];if(e){const t=e.RNA_ELT_TYPE.split("&")[0],o=e.RNA_ELT_POS.split("&")[0];let a=`CDS: ${e.CDS_position} and protein: ${e.Protein_position}`;e.RNA_ELT_POS.endsWith("prim")&&(a=e.RNA_ELT_POS.split("&")[1]),n=`${t} ${o} (${a})`}return n}},{title:"Strand 1",value:function(t){const n=t._strand_bnd_1;let e=".";const o=t.features_annotation[0];return o&&o.STRAND&&(e=o.STRAND),`${n}/${e}`}},{title:"Strand 2",value:function(t){const n=t._strand_bnd_2;let e=".";const o=t.features_annotation[1];return o&&o.STRAND&&(e=o.STRAND),`${n}/${e}`}}]},annotations:function(){let t=[];const n=this.data.breakends[0].coordinates.strand,e=this.data.breakends[1].coordinates.strand;return this.data.annotations.forEach(function(o){o._strand_bnd_1=n,o._strand_bnd_2=e,t.push(o)}),t}},template:'<dynamic-table\n            :data="annotations"\n            :export_title="export_title"\n            :header="header"\n            :menu="menu"\n            :scroll_x="scroll_x"\n            :title="title">\n        </dynamic-table>'});


/*!
  * AnaCore-web fusionsTable component v1.7.0
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const ftable_getAnnotationsStrands=function(e){let t={};return e.features.forEach(e=>{let n=e.Gene;null!=n&&(null!=e.SYMBOL&&(n=e.SYMBOL),t[n]=e.STRAND)}),Object.keys(t).sort().map(e=>t[e])},ftable_header=function(e=!1,t={},n=null){let r=[{title:"Gene 1",is_array:!0,href_target:"_blank",subEntryHref:function(e){return`https://www.genecards.org/cgi-bin/carddisp.pl?gene=${e}`},subEntrySeparator:", ",value:function(e){return e.getBNDGenesNames(0)}},{title:"Gene 2",is_array:!0,href_target:"_blank",subEntryHref:function(e){return`https://www.genecards.org/cgi-bin/carddisp.pl?gene=${e}`},subEntrySeparator:", ",value:function(e){return e.getBNDGenesNames(1)}},{title:"Location 1",value:function(e){return e.breakends[0].coordinates.region+": "+e.breakends[0].coordinates.annot_pos}},{title:"Location 2",value:function(e){return e.breakends[1].coordinates.region+": "+e.breakends[1].coordinates.annot_pos}},{title:"Sources",help:"Fusion was found by these software.",is_array:!0,subEntrySeparator:", ",value:function(e){return e.sources}},{title:"Filters",is_array:!0,subEntryClass:function(e){let n=["ftable-label","ftable-label-danger"];return t.hasOwnProperty(e)&&(n=["ftable-label",t[e]]),n},value:function(e){return e.filters}},{title:"Spanning reads",typeFct:parseInt,is_array:!0,sort:"desc",entryClass:function(e){return null==n||e.supports.by_src.hasOwnProperty(n)?null:"ftable-noStdCaller"},help:"Number of reads split by fusion.",value:function(e){let t=null;t=null!=n&&e.supports.by_src.hasOwnProperty(n)?e.supports.by_src[n]:e.supports.by_src[e.supports.selected];let r=[];return t.libraries.forEach(function(e){r.push(e.spanning_reads)}),r}},{title:"Spanning pairs",typeFct:parseInt,is_array:!0,entryClass:function(e){return null==n||e.supports.by_src.hasOwnProperty(n)?null:"ftable-noStdCaller"},help:"Number of reads pairs supporting fusion: breakend is between two reads.",value:function(e){let t=null;t=null!=n&&e.supports.by_src.hasOwnProperty(n)?e.supports.by_src[n]:e.supports.by_src[e.supports.selected];let r=[];return t.libraries.forEach(function(e){r.push(e.spanning_pairs)}),r}},{title:"Strand 1",help:"Strand for : the sequence in fusion / the transcript in gene.",value:function(e){return e.breakends[0].coordinates.strand+"/"+ftable_getAnnotationsStrands(e.breakends[0]).join(",")}},{title:"Strand 2",help:"Strand for : the sequence in fusion / the transcript in gene.",value:function(e){return e.breakends[1].coordinates.strand+"/"+ftable_getAnnotationsStrands(e.breakends[1]).join(",")}},{title:"Frame 2 status",help:"Status of the reading frame for the downstream partner:<ul><li>keep_frame: at least one of the alternative transcript keep its reading frame.</li><li>shift: no alternative transcript keep its reading frame.</li><li>/: at least one alternative transcript has an undetermined reading frame status and others have shift.</li></ul>",value:function(e){return{null:"",true:"keep_frame",false:"shift"}[e.hasInFrame]}},{title:"Known partners",help:"Databases where a fusion of these genes is known.",is_html:!0,value:function(e){let t=[];const n=e.getBNDSymbols(0),r=e.getBNDSymbols(1);return n.forEach(function(a){r.forEach(function(s){const l=a+"_@_"+s;if(e.known_partners.hasOwnProperty(l)){const a=e.known_partners[l];let s=Object.keys(a).filter(e=>"PMID"!=e);s.sort();let i="";(n.length>1||r.length>1)&&(i=l+": "),i+='<span class="ftable-label ftable-label-na">'+s.join('</span> <span class="ftable-label ftable-label-na">')+"</span> ",t.push(i)}})}),t.join(", ")}},{title:"Pubmed",is_html:!0,is_array:!0,value:function(e){let t="";const n=e.getBNDSymbols(0),r=e.getBNDSymbols(1);return n.forEach(function(a){r.forEach(function(s){const l=a+"_@_"+s;if(e.known_partners.hasOwnProperty(l)){const a=e.known_partners[l];if(a.hasOwnProperty("PMID")){(n.length>1||r.length>1)&&(t+=l+": ");const e=a.PMID.length;a.PMID.forEach(function(n,r){r+1<10||r+1==e?t+=`<a target="_blank" href="https://pubmed.ncbi.nlm.nih.gov/${n}">${r+1}</a> `:r+1==10&&e>10&&(t+="... ")})}}})}),t}}];return e&&r.unshift({title:"Details",event:"see-detail",is_html:!0,value:function(e){return'<button type="button" class="btn btn-primary"><i class="fa fa-eye"></i></button>'}}),r};FusionsTable=Vue.component("fusions-table",{props:{data:{default:null,type:Array},export_title:String,filters:{default:null,type:Object},filters_colors:{default:function(){return{PASS:"ftable-label-good"}},type:Object},default_source:{type:String,default:null},details_button:{default:!1,type:Boolean},pagination_sizes:{default:function(){return[5,10,25,100]},type:Array},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},scroll_x:{default:!0,type:Boolean},title:{default:"Fusions found",type:String}},computed:{header:function(){return ftable_header(this.details_button,this.filters_colors,this.default_source)},scroll_x_fix:function(){let e=2;return this.details_button&&(e=0),e}},methods:{callDetails:function(e){this.$emit("see-detail",e)}},template:'<dynamic-table\n            v-on:see-detail="callDetails"\n            :data="data"\n            :export_title="export_title"\n            :header="header"\n            :pagination_sizes="pagination_sizes"\n            :menu="menu"\n            :scroll_x="scroll_x"\n            :scroll_x_fix="scroll_x_fix"\n            :title="title">\n        </dynamic-table>'});


/*!
  * BreakendViewer v1.0.1
  * Copyright 2020 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
function bndv_textEllipsis(t){const e=d3.select(this);let r=e.text();for(;e.node().getComputedTextLength()>e.attr("width")&&""!=r;)r=r.slice(0,-1),e.text(r+"...")}function bndv_getPlotFromOutEvent(t){let e=t.srcElement;return"svg"!=e.tagName&&(e=e.ownerSVGElement),e.__data__}function bndv_getPlotFromInEvent(t){let e=t.target;return"svg"!=e.tagName&&(e=e.ownerSVGElement),e.__data__}function bndv_tooltipMouseover(t,e=null){null==e&&(e=bndv_getPlotFromInEvent(d3.event)),e.tooltip.transition().duration("50").style("opacity","0.85"),e.tooltip.html(t).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-5+"px")}function bndv_tooltipMouseOut(){const t=bndv_getPlotFromOutEvent(d3.event);t.tooltip.transition().duration("50").style("opacity","0"),t.tooltip.html("").style("left","0px").style("top","0px")}function bndv_exonMouseOver(t){const e=bndv_getPlotFromInEvent(d3.event);bndv_tooltipMouseover(e.getExonTooltip(t),e)}function bndv_bndMouseOver(t){const e=bndv_getPlotFromInEvent(d3.event);bndv_tooltipMouseover(e.getBNDTooltip(t),e)}function bndv_bndStrandMouseOver(){bndv_tooltipMouseover("Fusion strand")}function bndv_trNameMouseOver(t){bndv_tooltipMouseover(t)}function bndv_domainMouseOver(t){const e=bndv_getPlotFromInEvent(d3.event);bndv_tooltipMouseover(e.getDomainTooltip(t),e)}function bndv_targetMouseOver(){bndv_tooltipMouseover("Click to select/unselect")}function bndv_targetClick(t){const e=d3.event,r=bndv_getPlotFromInEvent(e),a=d3.select(e.target);null!=t.link?(t.link.remove(),t.link=null):t.link=r.svg.select("#targets-overlay").append("rect").attr("x",a.attr("x")).attr("y",r.getTargetsTrackYStart()).attr("width",a.attr("width")).attr("height",parseInt(r.svg.style("height"))-r.getTargetsTrackYStart()).attr("class","target-area"),e.stopPropagation()}class BreakendViewer{constructor(t){this.x_scale=null,this.x_start=null,this.nb_transcripts=null,this.browser_padding=5,this.targets_track={padding:2,height:19},this.titles_area_padding=1,this.titles_area_width=117,this.score_area_width=20,this.container=null,this.tooltip=null,this.svg=null,this.svg_width=null,this.svg_height=null,this.transcript_vcenter_rate=.33,this.domain_height=12,this.domain_sub_linker_height=4,this.domain_layout_padding=1,this.domain_bottom_padding=1,this.utr_height=10,this.cds_height=20,this.skipped_width=12,this.getCDSClasses=null,this.getUTRClasses=null,this.getExonTooltip=function(t){return`Exon ${t.index+1}<br />${t.start}-${t.end}<br />`},this.getBNDTooltip=function(t){return t.start==t.end?`Breakend<br />Pos: ${t.pos}`:`Breakend<br />Start: ${t.start}<br />End : ${t.end}<br />Pos : ${t.pos}`},this.getDomainTooltip=function(t){return`${t.annot.desc}`},this.BND_strand_arrow={margin_top:2,width:60,height:12},Object.assign(this,t)}getTargetsTrackYStart(){return 0}getBrowserXStart(){return this.titles_area_width+this.score_area_width}getXfromGenomicPos(t,e){const r=this.browser_padding+this.getBrowserXStart(),a=this._scale_gp_by_coord[t],s=this._scale_groups[a],n=this.skipped_width*a;return(s.prev_nt+e-s.start+1)*this.x_scale+r+n}getTrTrackYStart(){return this.targets_track.height}getTrHeight(){return(parseInt(this.svg.style("height"))-this.getTrTrackYStart())/this.nb_transcripts}getTrYStart(t){return this.getTrTrackYStart()+t*this.getTrHeight()}getExonYStart(t,e=0){return this.getTrYStart(e)+(this.transcript_vcenter_rate*this.getTrHeight()-.5*t)}drawTargets(t,e){const r=this,a=this.getTargetsTrackYStart(),s=t.append("g").attr("class","targets");s.append("text").attr("x",this.titles_area_padding).attr("width",this.titles_area_width-2*this.titles_area_padding).attr("y",a+3+this.targets_track.height/2).attr("height",this.targets_track.height).text("Targets").attr("class","targets-title").each(bndv_textEllipsis),s.append("g").attr("id","targets-overlay");let n=s.append("g").attr("class","targets-browse");e.forEach(function(t){const e=r.getXfromGenomicPos(`${t.start}-${t.end}`,t.start-1),s=a+r.targets_track.height/2-(r.targets_track.height-2*r.targets_track.padding)/2,i=(t.end-t.start+1)*r.x_scale;n.data([{link:null}]).append("rect").attr("x",e).attr("y",s).attr("width",i).attr("height",r.targets_track.height-2*r.targets_track.padding).attr("class","target-element").on("mouseover",bndv_targetMouseOver).on("mouseout",bndv_tooltipMouseOut).on("click",bndv_targetClick)}),t.append("line").attr("x1",1).attr("y1",a+this.targets_track.height).attr("x2",parseInt(t.style("width"))-1).attr("y2",a+this.targets_track.height).attr("class","track-separator")}drawBNDSelectedArea(t,e,r,a=1){const s=this.getTrTrackYStart();let n=this.getBrowserXStart(),i=r-this.getBrowserXStart();("first"==e.order&&"-"==e.strand||"second"==e.order&&"+"==e.strand)&&(n=r+a,i=parseInt(this.svg.style("width"))-n),t.append("rect").attr("x",n).attr("y",s).attr("width",i).attr("height",parseInt(this.svg.style("height"))-s).attr("class","breakpoint-strand-area");const o=Math.min(this.BND_strand_arrow.width,i),h=this.BND_strand_arrow.height/2;let d=null,l=null;"first"==e.order?"+"==e.strand?(d=r-o+2,l=r-h-2-2):(d=r+a+o-2,l=r+a+h+2+2):"+"==e.strand?(d=r+a+2+2,l=r+a+o-h-2):(d=r-2-2,l=r+h-o+2);let c=t.append("g").on("mouseover",bndv_bndStrandMouseOver).on("mouseout",bndv_tooltipMouseOut);c.append("rect").attr("x","-"==e.strand?Math.min(d,l)-h-2:Math.min(d,l)-2).attr("y",s+this.BND_strand_arrow.margin_top).attr("height",this.BND_strand_arrow.height+4).attr("width",Math.abs(d-l)+h+4).attr("rx",2).attr("class","breakpoint-strand-sticker"),c.append("line").attr("class","arrow breakpoint-strand-arrow").attr("marker-end","url(#bnd-arrow-head)").attr("x1",d).attr("y1",s+this.BND_strand_arrow.margin_top+2+this.BND_strand_arrow.height/2).attr("x2",l).attr("y2",s+this.BND_strand_arrow.margin_top+2+this.BND_strand_arrow.height/2)}drawBNDAmbiguity(t,e){const r=this.getTrTrackYStart(),a=this.getXfromGenomicPos(`${e.start}-${e.end}`,e.start-1),s=(e.end-e.start+1)*this.x_scale;t.data([e]).append("rect").attr("x",a).attr("y",r).attr("width",s).attr("height",parseInt(this.svg.style("height"))-r).attr("class","breakpoint-ambiguity").on("mouseover",bndv_bndMouseOver).on("mouseout",bndv_tooltipMouseOut),"+"!=e.strand&&"-"!=e.strand||this.drawBNDSelectedArea(t,e,a,s)}drawBND(t,e){const r=this.getTrTrackYStart(),a=this.getXfromGenomicPos(`${e.start}-${e.end}`,e.pos-1);let s=t.data([e]).append("line").attr("x1",a).attr("y1",r).attr("x2",a).attr("y2",parseInt(this.svg.style("height"))).attr("class","breakpoint");e.start==e.end&&(s.on("mouseover",bndv_bndMouseOver).on("mouseout",bndv_tooltipMouseOut),"+"!=e.strand&&"-"!=e.strand||this.drawBNDSelectedArea(t,e,a,1))}drawTranscript(t,e,r,a=0){const s=this,n=this.getTrHeight(),i=this.getTrYStart(r),o=t.append("g").attr("class","transcript"),h=(this.getExonYStart(this.cds_height,r),null!=e.name?e.name:`tr_${r+1}`),d=o.append("g").attr("class","transcript-title");if(d.append("rect").attr("x",0).attr("width",this.titles_area_width).attr("y",i).attr("height",n).attr("class",`transcript-title-area-${a}`),d.data([h]).append("text").attr("x",1).attr("width",this.titles_area_width-2).attr("y",i+1+5+(n-2)/2).attr("height",n-2).text(h).attr("class","transcript-title-text").each(bndv_textEllipsis).on("mouseover",bndv_trNameMouseOver).on("mouseout",bndv_tooltipMouseOut),this.score_area_width>0){const t=o.append("g").attr("class","score");t.append("rect").attr("x",this.titles_area_width).attr("width",this.score_area_width).attr("y",i+2).attr("height",n-4).attr("class","transcript-score-area");let r=t.append("text").text(e.annot.hasOwnProperty("score")?e.annot.score.toFixed(2):"na").attr("class","transcript-score-value");const a=this.titles_area_width+this.score_area_width/2,s=a-r.node().getComputedTextLength()/2,h=i+n/2,d=h+r.node().getBBox().height/2-1;r.attr("x",s).attr("y",d),r.attr("transform",`rotate(-90, ${a}, ${h})`)}0!=r&&o.append("line").attr("x1",this.titles_area_width).attr("y1",i).attr("x2",parseInt(t.style("width"))-1).attr("y2",i).attr("class","transcript-separator");let l=o.append("g").attr("class","viewer");0!=e.proteins.length&&e.proteins.forEach(function(t){if(t.annot.hasOwnProperty("domains")){let e=l.append("g").attr("class","domains");const a=new GenomicList(t.annot.domains);let n=0,i={};a.forEach(function(t){let a=0,o=!1;for(;!o;)a+1>n?(i[a]={start:t.start,end:t.end,nb:1},n++,o=!0):t.start>i[a].end?(i[a]={start:t.start,end:t.end,nb:i[a].nb+1},o=!0):a++;s.drawDomain(e,t,r,a,i[a].nb-1)})}});let c=l.append("g").attr("class","introns");for(let t=0;t<e.exons.length-1;t++){const r=e.exons[t],a=e.exons[t+1],o=s.getXfromGenomicPos(`${r.start}-${r.end}`,r.end),h=s.getXfromGenomicPos(`${a.start}-${a.end}`,a.start-1),d=(h-o)/2;h-o<10?c.append("line").attr("class","arrow gene-strand-arrow").attr("x1",o).attr("y1",i+n*this.transcript_vcenter_rate).attr("x2",h).attr("y2",i+n*this.transcript_vcenter_rate):"+"==e.strand?(c.append("line").attr("class","arrow gene-strand-arrow").attr("x1",o+d).attr("y1",i+n*this.transcript_vcenter_rate).attr("x2",h).attr("y2",i+n*this.transcript_vcenter_rate),c.append("line").attr("class","arrow gene-strand-arrow").attr("marker-end","url(#gene-arrow-head)").attr("x1",o).attr("y1",i+n*this.transcript_vcenter_rate).attr("x2",o+d).attr("y2",i+n*this.transcript_vcenter_rate)):(c.append("line").attr("class","arrow gene-strand-arrow").attr("x2",o).attr("y1",i+n*this.transcript_vcenter_rate).attr("x1",o+d).attr("y2",i+n*this.transcript_vcenter_rate),c.append("line").attr("class","arrow gene-strand-arrow").attr("marker-end","url(#gene-arrow-head)").attr("x2",o+d).attr("y1",i+n*this.transcript_vcenter_rate).attr("x1",h).attr("y2",i+n*this.transcript_vcenter_rate))}let g=l.append("g").attr("class","exons");const p=e.exons.length;if(null==e.proteins||0==e.proteins.length)e.exons.forEach(function(t,a){t.hasOwnProperty("index")||(t.index="+"==e.strand?a:p-a-1),s.drawUTR(g,t,r)});else{const t=e.proteins.length;let a=0,n=e.proteins[a];e.exons.forEach(function(i,o){i.hasOwnProperty("index")||(i.index="+"==e.strand?o:p-o-1);let h=i;for(;null!=h;)if(n.start<=h.start&&n.end>=h.end)s.drawCDS(g,i,r,h),n.end==h.end&&a+1<t&&(a++,n=e.proteins[a]),h=null;else if(h.end<n.start||h.start>n.end)s.drawUTR(g,i,r,h),h=null;else{if(h.start<n.start){let t=JSON.parse(JSON.stringify(h));t.end=n.start-1,s.drawUTR(g,i,r,t),(h=JSON.parse(JSON.stringify(h))).start=n.start}if(h.end>n.end){let o=JSON.parse(JSON.stringify(h));o.end=n.end,s.drawCDS(g,i,r,o),(h=JSON.parse(JSON.stringify(h))).start=n.end+1,a+1<t&&(a++,n=e.proteins[a])}}})}}drawDomain(t,e,r,a=0,s=0){const n=this.getTrHeight(),i=this.getTrYStart(r),o=a*(this.domain_layout_padding+this.domain_height),h=(a+1)%2==0?"layout-pair":"layout-unpair",d=(s+1)%2==0?"domain-pair":"domain-unpair";let l=t;if(e.annot.hasOwnProperty("id")&&e.annot.id.startsWith("InterPro")&&(l=l.append("a").attr("href",`https://www.ebi.ac.uk/interpro/entry/InterPro/${e.annot.id.split(":")[1]}`).attr("target","_blank").attr("class","clickable")),e.annot.hasOwnProperty("sub")){const t=this,r=e.annot.sub.split(","),a=r.length;r.forEach(function(s,c){let[g,p]=s.split("-");g=parseInt(g),p=parseInt(p);const _=t.getXfromGenomicPos(s,g-1),u=t.getXfromGenomicPos(s,p);if(l.data([e]).append("rect").attr("x",_).attr("y",i+n-t.domain_bottom_padding-t.domain_height-o).attr("width",(p-g+1)*t.x_scale).attr("height",t.domain_height).attr("class",`domain ${h} ${d}`).on("mouseover",bndv_domainMouseOver).on("mouseout",bndv_tooltipMouseOut),c<a-1){const a=r[c+1];let[s,g]=a.split("-");s=parseInt(s),l.data([e]).append("line").attr("x1",u).attr("x2",t.getXfromGenomicPos(a,s-1)).attr("y1",i+n-t.domain_bottom_padding-t.domain_height/2-o).attr("y2",i+n-t.domain_bottom_padding-t.domain_height/2-o).attr("class",`domain-linker ${h} ${d}`).on("mouseover",bndv_domainMouseOver).on("mouseout",bndv_tooltipMouseOut)}})}else{const t=this.getXfromGenomicPos(`${e.start}-${e.end}`,e.start-1);this.getXfromGenomicPos(`${e.start}-${e.end}`,e.end);l.data([e]).append("rect").attr("x",t).attr("y",i+n-this.domain_bottom_padding-this.domain_height-o).attr("width",(e.end-e.start+1)*this.x_scale).attr("height",this.domain_height).attr("class",`domain ${h} ${d}`).on("mouseover",bndv_domainMouseOver).on("mouseout",bndv_tooltipMouseOut)}}drawUTR(t,e,r,a=null){const s=null==a?e:a,n=this.getXfromGenomicPos(`${e.start}-${e.end}`,s.start-1),i=this.getExonYStart(this.utr_height,r),o=(s.end-s.start+1)*this.x_scale;let h="utr utr-fill";null!=this.getExonColor?h="utr":null!=this.getUTRClasses&&(h=this.getUTRClasses);let d=t.data([e]).append("rect").attr("x",n).attr("y",i).attr("width",o).attr("height",this.utr_height).attr("class",h);null!=this.getExonColor&&d.attr("fill",this.getExonColor(e,this)),null!=this.getExonTooltip&&d.on("mouseover",bndv_exonMouseOver).on("mouseout",bndv_tooltipMouseOut)}drawCDS(t,e,r,a=null){const s=null==a?e:a,n=this.getXfromGenomicPos(`${e.start}-${e.end}`,s.start-1),i=this.getExonYStart(this.cds_height,r),o=(s.end-s.start+1)*this.x_scale;let h="cds cds-fill";null!=this.getExonColor?h="cds":null!=this.getCDSClasses&&(h=this.getCDSClasses);let d=t.data([e]).append("rect").attr("x",n).attr("y",i).attr("width",o).attr("height",this.cds_height).attr("rx",1).attr("class",h);null!=this.getExonColor&&d.attr("fill",this.getExonColor(e,this)),null!=this.getExonTooltip&&d.on("mouseover",bndv_exonMouseOver).on("mouseout",bndv_tooltipMouseOut)}declareArrow(t){const e=t.append("defs");let r=this.BND_strand_arrow.height-2;e.append("marker").attr("id","bnd-arrow-head").attr("refX",r/2).attr("refY",r/2).attr("markerWidth",2*r).attr("markerHeight",2*r).attr("orient","auto").append("path").attr("d",`M 0 0 ${r} ${r/2} 0 ${r} ${r/4} ${r/2}`).attr("class","breakpoint-strand-arrow"),r=6,e.append("marker").attr("id","gene-arrow-head").attr("refX",r/2).attr("refY",r/2).attr("markerWidth",2*r).attr("markerHeight",2*r).attr("orient","auto").append("path").attr("d",`M 0 0 ${r} ${r/2} 0 ${r} ${r/4} ${r/2}`).attr("class","gene-strand-arrow")}setSvgHeight(t=null){this._svg_height_fix=this.svg_height,null==this.svg_height&&(this._svg_height_fix=this.nb_transcripts*(Math.max(this.cds_height,this.utr_height)+40+3*this.domain_height),null!=this.targets&&(this._svg_height_fix+=this.targets_track.height))}setScaleGroup(t,e,r=[]){const a=this;let s=[];s.push(e),t.forEach(function(t){t.transcripts.forEach(function(t){t.exons.forEach(function(t){s.push(t)}),t.proteins.forEach(function(t){t.annot.hasOwnProperty("domains")&&t.annot.domains.forEach(function(t){t.annot.hasOwnProperty("sub")?t.annot.sub.split(",").forEach(function(t){const[e,r]=t.split("-");s.push({start:parseInt(e),end:parseInt(r)})}):s.push(t)})})})}),null!=r&&r.forEach(function(t){s.push(t)}),s=new GenomicList(s),this._scale_gp_by_coord={},this._scale_groups=[{start:s[0].start,end:s[0].end}];let n=0,i=this._scale_groups[0];s.forEach(function(t){if(i.end<t.start){n++;let e={start:t.start,end:t.end};a._scale_groups.push(e),i=e}else i.end=Math.max(i.end,t.end);a._scale_gp_by_coord[`${t.start}-${t.end}`]=n});let o=0;this._scale_groups.forEach(function(t){t.prev_nt=o,o+=t.end-t.start+1});const h=this.svg_width-this.getBrowserXStart()-2*this.browser_padding-this.skipped_width*(this._scale_groups.length-1);this.x_scale=h/o}render(t,e,r=null){this.x_start=Math.min(t.map(function(t){return t.start}));const a=Math.max(t.map(function(t){return t.end}));this.nb_transcripts=t.reduce(function(t,e){return t+e.transcripts.length},0),null!=r&&(Object.getPrototypeOf(r).constructor!=GenomicList&&(r=new GenomicList(r)),r=r.trimmed(this.x_start,a)),this.setSvgHeight(r),this.svg=d3.select(this.container).append("svg").style("width",this.svg_width+"px").style("height",this._svg_height_fix+"px"),this.tooltip=d3.select("#bndv-tooltip"),this.tooltip.empty()&&(this.tooltip=d3.select("html").append("div").attr("id","bndv-tooltip").attr("class","bndv-tooltip").style("opacity",0)),this.declareArrow(this.svg),this.setScaleGroup(t,e,r),null!=r&&this.drawTargets(this.svg,r);let s=this.svg.append("g");e.start!=e.end&&this.drawBNDAmbiguity(s,e);const n=this;let i=0;t.forEach(function(t,e){t.transcripts.forEach(function(t){n.drawTranscript(n.svg,t,i,e),i++})}),this.drawBND(s,e),this.svg.data([this])}static chart(t,e,r,a=null){let s=new BreakendViewer(r);null==a&&(s.targets_track.height=0),s.render(e,t,a)}}


/*!
  * BreakendViewer component v1.0.1
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const BreakendViewerVue=Vue.component("breakend-viewer",{props:{breakend:{type:Object,required:!0},genes:{type:Array,required:!0},parameters:{type:Object,required:!0},targets:{type:Array,required:!1,default:null}},computed:{cpt_params:function(){let e={};return Object.assign(e,this.parameters),e.container=this.$el,e},data_id:function(){this.breakend,this.genes,this.parameters,this.targets;return Date.now()+"-"+Math.floor(1e4*Math.random())}},mounted:function(){BreakendViewer.chart(this.breakend,this.genes,this.cpt_params,this.targets)},beforeUpdate:function(){null!==this.$el.lastChild&&this.$el.lastChild.remove()},updated:function(){BreakendViewer.chart(this.breakend,this.genes,this.cpt_params,this.targets)},template:'<div :data-id="data_id"></div>'});


/*!
  * AnaCore-web breakendViewerAC component v2.0.0
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
function bndvac_getColor(e,n,t){let r=0,o=0,a=0;if(t<=e)r=255;else{const r=Math.max(0,1-(t-e)/(n-e));a=Math.round(255*r),o=255}return"#"+("000000"+(65536*r+256*o+1*a).toString(16)).slice(-6)}Vue.component("breakend-viewer-ac",{props:{analysis:{type:Object,required:!0},breakend:{type:Object,required:!0},order:{type:String,required:!0},width:{type:Number,required:!0}},data:function(){return{getExonColor:function(e,n){return bndvac_getColor(15,n.add_data.max_depth,e.annot.depth.med)},getExonTooltip:function(e){return`Depth of exon ${e.index+1}<br />${e.start}-${e.end}<br />Mean: ${e.annot.depth.mean.toFixed(2)}<br />Median: ${e.annot.depth.med.toFixed(2)}`}}},computed:{in_parameters:function(){return{add_data:{max_depth:this.max_depth},getExonColor:this.getExonColor,getExonTooltip:this.getExonTooltip,score_area_width:this.has_score?20:0,svg_width:this.width}},in_breakend:function(){const e=this.breakend.coordinates;return{start:null==e.cipos?e.pos:e.pos+e.cipos[0],end:null==e.cipos?e.pos:e.pos+e.cipos[1],pos:e.annot_pos,order:this.order,strand:e.strand}},genes_id:function(){let e=new Set;return this.breakend.features.forEach(function(n){e.add(n.Gene)}),e},genes_names:function(){let e=new Set;return this.breakend.features.forEach(function(n){e.add(n.SYMBOL)}),(e=Array.from(new Set(e))).sort(),e},in_genes:function(){const e=this;let n=new Array;return this.genes_id.forEach(function(t){n.push(e.analysis.gene_by_id[t])}),n},in_targets:function(){let e=null;return null!=this.analysis.targets_by_chr&&(e=new GenomicList([]),this.analysis.targets_by_chr.hasOwnProperty(this.breakend.coordinates.region)&&(e=this.analysis.targets_by_chr[this.breakend.coordinates.region])),e},max_depth:function(){let e=0;return this.in_genes.forEach(function(n){n.transcripts.forEach(function(n){n.exons.forEach(function(n){e=Math.max(e,n.annot.depth.med)})})}),e},has_score:function(){let e=!1;return this.in_genes.forEach(function(n){n.transcripts.forEach(function(n){n.annot.hasOwnProperty("score")&&(e=!0)})}),e}},template:"<breakend-viewer\n            :breakend=in_breakend\n            :genes=in_genes\n            :parameters=in_parameters\n            :targets=in_targets>\n        </breakend-viewer>"});


/*!
  * AnaCore-web tinyHighchart component v1.3.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
function getGraph(t,e,i=null,r=null,s=null,n=!0,l="x",a=!1){let o={chart:{type:t,zoomType:l,inverted:a},xAxis:{title:{text:i}},yAxis:{title:{text:r}},credits:{enabled:!1},series:e};return null!=s&&(o.title={text:s}),n&&(o.tooltip={crosshairs:[!0],shared:!0,formatter:function(){let t=[this.points[0].series.xAxis.axisTitle.textStr+" <b>"+this.points[0].x+"</b>:"];return this.points.forEach(function(e,i){t.push('<b><span style="color:'+e.series.color+'">'+e.series.name+"</b></span>: <b>"+e.y+"</b>")}),t.join("<br />")}}),o}Vue.component("tiny-highchart",{props:{series:{type:Array,required:!0},chart_type:{type:String,default:"line"},x_title:{type:String,default:null},y_title:{type:String,default:null},title:{type:String,default:null},x_tick_interval:{type:Number,default:null},x_tick_categories:{type:Array,default:null},y_min:{type:Number,default:null},x_min:{type:Number,default:null},zoom_type:{type:String,default:"x"},has_inverted_axis:{type:Boolean,default:!1}},mounted:function(){this.drawGraph()},watch:{count_by_cat:function(t){this.drawGraph()}},computed:{graph_parameters:function(){const t="boxplot"!=this.chart_type;let e=getGraph(this.chart_type,this.series,this.x_title,this.y_title,this.title,t,this.zoom_type,this.has_inverted_axis);return null!==this.x_tick_interval?e.xAxis.tickInterval=this.x_tick_interval:this.x_tick_categories&&(e.xAxis.categories=this.x_tick_categories),null!==this.x_min&&(e.xAxis.min=this.x_min),null!==this.y_min&&(e.yAxis.min=this.y_min),e}},methods:{drawGraph:function(){const t=this.$el,e=$(window).scrollTop();Highcharts.chart(t,this.graph_parameters),$(window).scrollTop(e)}},template:"<div></div>"});


/*!
  * AnaCore-web thresholdAlert component v1.2.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
class ThresholdAlert{constructor(e,t,s="",r=""){this.text_pre=t,this.rules=e,this.text_post=s,this.value_suffix=r}}Vue.component("threshold-alert",{props:{threshold:{required:!0,type:Object},value:{required:!0}},methods:{getThresholdCategory:function(e,t){let s=null;return Object.keys(e).sort(function(e,t){return parseFloat(e)-parseFloat(t)}).forEach(function(r){parseFloat(r)<=parseFloat(t)&&(s=e[r])}),s}},computed:{category_classes:function(){return"alert alert-"+this.getThresholdCategory(this.threshold.rules,this.value)}},template:'<div :class="category_classes" role="alert">\n            {{threshold.text_pre}} <span class="right-badge">{{value}}{{threshold.value_suffix}}</span> {{threshold.text_post}}\n        </div>'});


/*!
  * AnaCore-web runDensityGraph component v1.0.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
Vue.component("run-density-graph",{props:{analysis:{type:Object,required:!0}},data:function(){return{categories:["Run"]}},computed:{chart_series:function(){return[{name:"Density",data:[[this.analysis.density.min,this.analysis.density["25_percentile"],this.analysis.density["50_percentile"],this.analysis.density["75_percentile"],this.analysis.density.max]]},{name:"Density PF",data:[[this.analysis.density_PF.min,this.analysis.density_PF["25_percentile"],this.analysis.density_PF["50_percentile"],this.analysis.density_PF["75_percentile"],this.analysis.density_PF.max]]}]}},template:'<tiny-highchart\n            chart_type="boxplot"\n            :series="chart_series"\n            title="FlowCell clusters density"\n            y_title="Clusters/mm2"\n            :x_tick_categories=categories>\n        </tiny-highchart>'});


/*!
  * AnaCore-web runDensityCardContent component v1.0.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const rdensity_spec_by_instrument={MiniSeq:{220:"error",170:"good",119:"warning",0:"error"},MiSeq_v2:{1200:"error",1000:"good",700:"warning",0:"error"},MiSeq_v3:{1400:"error",1200:"good",840:"warning",0:"error"},NextSeq:{220:"error",170:"good",119:"warning",0:"error"},HiSeq_v2:{1000:"error",850:"good",595:"warning",0:"error"},HiSeq_v3:{850:"error",750:"good",525:"warning",0:"error"},HiSeq_v4:{1050:"error",950:"good",665:"warning",0:"error"}};Vue.component("run-density-card-content",{props:{interop_summary:{default:null,type:Object},run_info:{default:null,type:Object},density_spec:{default:function(){return rdensity_spec_by_instrument},type:Object}},data:function(){return{threshold_ratio_PF:new ThresholdAlert({20:"danger",10:"warning",5:"success",0:"good"},"","of clusters do not pass filters","%")}},computed:{threshold_density:function(){let r=null;if(null!==this.run_info){let e=this.run_info.instrument.platform;"MiSeq"!=e&&"HiSeq"!=e||this.run_info.hasOwnProperty("kit")&&(e+="_"+this.run_info.kit.version),this.density_spec.hasOwnProperty(e)&&(r=new ThresholdAlert(this.density_spec[e],"Run density",""," KC/mm2"))}return r},value_density:function(){return(this.interop_summary.density["50_percentile"]/1e3).toFixed(0)},value_ratio_PF:function(){return(100*(1-this.interop_summary.density_PF["50_percentile"]/this.interop_summary.density["50_percentile"])).toFixed(1)}},template:'<div>\n            <div class="row" v-if="interop_summary !== null">\n                <div class="col-md-2"></div>\n                <div class="col-md-6">\n                    <run-density-graph\n                        :analysis=interop_summary>\n                    </run-density-graph>\n                </div>\n                <div class="col-md-2">\n                    <threshold-alert v-if="threshold_density !== null"\n                        :threshold=threshold_density\n                        :value=value_density>\n                    </threshold-alert>\n                    <threshold-alert\n                        :threshold=threshold_ratio_PF\n                        :value=value_ratio_PF>\n                    </threshold-alert>\n                </div>\n                <div class="col-md-2"></div>\n            </div>\n        </div>'});


/*!
  * AnaCore-web runErrorGraph component v1.0.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
Vue.component("run-error-graph",{props:{title:{type:String,default:"Control sequence error rate"},analysis:{type:Object,required:!0},run_phases:{type:Array,required:!0}},computed:{categories:function(){let e=0;return this.chart_series.forEach(function(r){e=Math.max(e,r.data.length)}),Array.from({length:e},(e,r)=>r+1)},chart_series:function(){const e=this;let r=[];idx_read=0,this.run_phases.forEach(function(e){e.is_index||(r.push({name:"R"+(idx_read+1),data:[]}),idx_read++)});let t=0,a=0;return this.run_phases.forEach(function(n,i){if(!n.is_index){const n=e.run_phases[i].nb_cycles;for(let i=0;i<n-1;i++)r[a].data.push([e.analysis.error_rate.min[t],e.analysis.error_rate["25_percentile"][t],e.analysis.error_rate["50_percentile"][t],e.analysis.error_rate["75_percentile"][t],e.analysis.error_rate.max[t]]),t++;a++}}),r}},template:'<tiny-highchart\n            chart_type="boxplot"\n            :series="chart_series"\n            :title="title"\n            y_title="Error rate (%)"\n            :y_min=0\n            x_title="Sequencing cycle"\n            :x_tick_categories=categories>\n        </tiny-highchart>'});


/*!
  * AnaCore-web runQualityCardContent component v1.0.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const rquality_spec_error={whole_phase_error:{1.5:"error",1:"warning",.5:"success",0:"good"},block_error:{2:"error",1.5:"warning",1:"success",0:"good"},ponctual_error_few_reads:{0:"good",1:"warning",3:"error"},ponctual_error_lot_reads:{0:"good",1:"error"}};Vue.component("run-quality-card-content",{props:{interop_summary:{default:null,type:Object},run_phases:{default:null,type:Array},block_size:{default:20,type:Number},lot_reads:{default:10,type:Number},few_reads:{default:5,type:Number},ponctual_error_threshold:{default:3,type:Number},alerts_thresholds:{default:function(){return rquality_spec_error},type:Object}},computed:{thrld_whole_phase_error:function(){return new ThresholdAlert(this.alerts_thresholds.whole_phase_error,"Error rate on whole phase:","","%")},thrld_block_error:function(){return new ThresholdAlert(this.alerts_thresholds.block_error,"Error rate by block ("+this.block_size+" cycles):","","%")},thrld_ponctual_error_few_reads:function(){return new ThresholdAlert(this.alerts_thresholds.ponctual_error_few_reads,"","cycles with strong error rate ("+this.ponctual_error_threshold+"%) on "+this.few_reads+"% of reads.")},thrld_ponctual_error_lot_reads:function(){return new ThresholdAlert(this.alerts_thresholds.ponctual_error_lot_reads,"","cycles with strong error rate ("+this.ponctual_error_threshold+"%) on "+this.lot_reads+"% of reads.")},metrics:function(){const r=this;let e={avg_error_in_phase:0,avg_error_in_block:0,nb_ponctual_error_few_reads:0,nb_ponctual_error_lot_reads:0},t=[];const o=100-this.lot_reads+"_percentile",l=100-this.few_reads+"_percentile";let _=0;return this.run_phases.forEach(function(s,n){if(!s.is_index){const n=s.nb_cycles;let a=0,h=0,d=[];for(let s=0;s<n-1;s++){if(a+=r.interop_summary.error_rate["75_percentile"][_],h++,d.push(r.interop_summary.error_rate["75_percentile"][_]),s+1>=r.block_size){let e=0;for(let t=0;t<r.block_size;t++)e+=d[t];t.push(e/r.block_size),d.shift()}r.interop_summary.error_rate[o][s]>=r.ponctual_error_thrld&&(e.nb_ponctual_error_lot_reads+=1),r.interop_summary.error_rate[l][s]>=r.ponctual_error_thrld&&(e.nb_ponctual_error_few_reads+=1),_++}e.avg_error_in_phase=Math.max(e.avg_error_in_phase,a/h).toFixed(2)}}),e.avg_error_in_block=Math.max(...t).toFixed(2),e}},template:'<div>\n            <div class="row" v-if="interop_summary !== null">\n                <div class="col-md-10">\n                    <run-error-graph v-if="interop_summary !== null"\n                        :run_phases=run_phases\n                        :analysis=interop_summary>\n                    </run-error-graph>\n                </div>\n                <div class="col-md-2" if="metrics !== null">\n                    <threshold-alert\n                        :threshold=thrld_whole_phase_error\n                        :value=metrics.avg_error_in_phase>\n                    </threshold-alert>\n                    <threshold-alert\n                        :threshold=thrld_block_error\n                        :value=metrics.avg_error_in_block>\n                    </threshold-alert>\n                    <threshold-alert\n                        :threshold=thrld_ponctual_error_few_reads\n                        :value=metrics.nb_ponctual_error_few_reads>\n                    </threshold-alert>\n                    <threshold-alert\n                        :threshold=thrld_ponctual_error_lot_reads\n                        :value=metrics.nb_ponctual_error_lot_reads>\n                    </threshold-alert>\n                </div>\n            </div>\n        </div>'});
