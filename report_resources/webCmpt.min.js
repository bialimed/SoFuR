/*!
  * fusions v1.2.0
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
class Curation{constructor(t,n=null,s=null,r=Date.now()){this.status=t,this.date=r,this.author=n,this.description=s}static fromJSON(t){let n=new Curation(t.status);return Object.keys(t).forEach(function(s){n[s]=t[s]}),n}}class Fusion{constructor(t,n,s,r,e={},o=[]){this.annotations=s,this.breakends=t,this.curations=o,this.filters=r,this.known_partners=e,this.supports=n}get sources(){let t=Object.keys(this.supports);return t.sort(),t}get hasInFrame(){let t={true:0,false:0,".":0};this.annotations.forEach(function(n){t[n.inframe]+=1});let n=!1;return t[!0]>0?n=!0:t["."]>0&&(n=null),n}getSymbols(t){let n=[];const s=this.breakends[t].features_by_id;for(const t in s)null!==s[t].SYMBOL&&n.push(s[t].SYMBOL);return(n=Array.from(new Set(n))).sort(),n}getSymbolsName(){return this.getSymbols(0).join(",")+" @ "+this.getSymbols(1).join(",")}getStrands(t){let n={};const s=this.breakends[t].features_by_id;for(const t in s){const r=s[t].SYMBOL;null!==r&&(n[r]=s[t].STRAND)}return n}getJunctionsTypesPairs(){let t=[];return this.annotations.forEach(function(n){const s=n.features_annotation[0],r=n.features_annotation[1],e=null===s?"no_feature":s.RNA_ELT_TYPE,o=null===r?"no_feature":r.RNA_ELT_TYPE;t.push(e+" to "+o)}),(t=Array.from(new Set(t))).sort(),t}static fromJSON(t){const n=[t.breakends[0].features_by_id,t.breakends[1].features_by_id];t.annotations.forEach(function(t){t.features_annotation.forEach(function(s,r){"string"==typeof s&&(t.features_annotation[r]=n[r][s])})});let s={};t.hasOwnProperty("supports")&&t.supports.forEach(function(t){if(s.hasOwnProperty(t.source))throw"The source already exist '{curr_support.source}'";s[t.source]=t});let r={};t.hasOwnProperty("known_partners")&&(r=t.known_partners);let e=[];return t.hasOwnProperty("curations")&&t.curations.forEach(function(t){e.push(Curation.fromJSON(t))}),new Fusion(t.breakends,s,t.annotations,t.filters,r,e)}}

/*!
  * dynamicTable component v1.4.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
DynamicTable=Vue.component("dynamic-table",{props:{data:Array,filters:Object,header:{required:!0,type:Array},pagination_sizes:{default:function(){return[10,25,50,100]},array:Array},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},export_title:{default:null,type:String},scroll_x:{default:!1,type:Boolean},scroll_x_fix:{default:0,type:Number},title:String},mounted:function(){$(this.$el).DataTable(this.datatableParams)},computed:{is_multi_rows_header:function(){return 0!==this.header.length&&Array.isArray(this.header[0])},nb_columns:function(){let t=0,e=this.header;return this.is_multi_rows_header&&(e=this.header[0]),e.forEach(function(e){e.hasOwnProperty("colspan")?t+=e.colspan:t+=1}),t},header_mask:function(){let t=this.header;if(this.is_multi_rows_header){const e=this.header.length,l=this.nb_columns;(t=new Array(e).fill([])).forEach(function(e,n){t[n]=new Array(l).fill(null)}),this.header.forEach(function(e,l){col_idx=0,e.forEach(function(e){for(;null!==t[l][col_idx];)col_idx+=1;colspan=e.hasOwnProperty("colspan")?e.colspan:1,rowspan=e.hasOwnProperty("rowspan")?e.rowspan:1;for(let n=l;n<l+rowspan;n++)for(let l=col_idx;l<col_idx+colspan;l++)t[n][l]=e;col_idx+=1})})}return t},columns:function(){let t=this.header_mask;return this.is_multi_rows_header&&(t=t[t.length-1]),t},filteredData:function(){let t=this.data;if(null!=this.filters){const e=this;t=t.filter(function(t){return e.filters.eval(t)})}return t},datatableParams:function(){order_rule=[[0,"asc"]],this.columns.forEach(function(t,e){t.hasOwnProperty("sort")&&(order_rule=[[e,t.sort]])});let t={dom:"",order:order_rule,lengthMenu:this.pagination_sizes};return this.scroll_x&&(t.scrollX=!0,0!=this.scroll_x_fix&&(t.fixedColumns={leftColumns:this.scroll_x_fix})),this.menu.pagination&&(this.menu.filter&&(t.dom="f"),this.menu.export?t.dom="<'d-md-none'<'row'<'col-sm-12'B><'col-sm-12'l><'col-sm-12'"+t.dom+"r>>><'d-none d-md-block'<'row'<'col-md-6'<'row'<'dtable-head-btn'B>l>><'col-md-6'"+t.dom+"r>>><'row'<'col-sm-12't>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>":t.dom="<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'"+t.dom+"r>><'row'<'col-sm-12't>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>"),this.menu.export&&(null===this.export_title?t.buttons=["csv","excel"]:t.buttons=[{extend:"csv",title:this.export_title},{extend:"excel",title:this.export_title}]),t},datatableStyle:function(){let t={};return this.scroll_x&&(t={width:"100%","border-bottom":"none"}),t}},beforeUpdate:function(){$(this.$el).DataTable().destroy()},updated:function(){$(this.$el).DataTable(this.datatableParams)},methods:{getValue:function(t,e){return this.$options.filters.getValue(t,e)}},filters:{getValue:function(t,e){let l=null;return e.hasOwnProperty("value")?l=e.value(t):t.hasOwnProperty(e.title)&&(l=t[e.title]),l},getHref:function(t,e){return e.href(t)},getClass:function(t,e){let l=null;return e.hasOwnProperty("class")&&(l=[e.class]),e.hasOwnProperty("entryClass")&&(added_class=e.entryClass(t),null===l?l=[added_class]:l.push(added_class)),l},getSubClass:function(t,e){let l=null;return e.hasOwnProperty("subEntryClass")&&(added_class=e.subEntryClass(t),null===l?l=[added_class]:l.push(added_class)),l},getSubHref:function(t,e){return e.subEntryHref(t)},getSubSeparator:function(t){let e=" ";return t.hasOwnProperty("subEntrySeparator")&&(e=t.subEntrySeparator),e},getRowSpan:function(t){return t.hasOwnProperty("rowspan")?t.rowspan:1},getColSpan:function(t){return t.hasOwnProperty("colspan")?t.colspan:1}},template:'<table class="table table-striped" :style="datatableStyle">\n\t\t\t<caption>\n\t\t\t\t{{title}}\n\t\t\t</caption>\n\t\t\t<thead>\n\t\t\t\t<template v-if="!is_multi_rows_header">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th v-for="col in columns">{{col.title}}</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<tr v-for="row in header">\n\t\t\t\t\t\t<th v-for="col in row"\n\t\t\t\t\t\t\t:rowspan="col | getRowSpan"\n\t\t\t\t\t\t\t:colspan="col | getColSpan">\n\t\t\t\t\t\t\t{{col.title}}\n\t\t\t\t\t\t</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</template>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t<tr v-for="entry in filteredData">\n\t\t\t\t\t<td v-for="(col, col_idx) in columns" :class="entry | getClass(col)">\n\t\t\t\t\t\t<template v-if="col.is_html">\n\t\t\t\t\t\t\t<span v-html="getValue(entry, col)" v-on:click="col.event ? $emit(col.event, entry) : null"></span>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<template v-if="col.href">\n\t\t\t\t\t\t\t\t<a :target="col.href_target ? col.href_target : \'_self\'" :href="entry | getHref(col)">\n\t\t\t\t\t\t\t\t\t<template v-if="col.is_array">\n\t\t\t\t\t\t\t\t\t\t<template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n\t\t\t\t\t\t\t\t\t\t\t<span v-if="sub_idx != 0">{{col | getSubSeparator}}</span><span :class="sub_value | getSubClass(col)">{{sub_value}}</span>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t{{entry | getValue(col)}}\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<template v-if="col.is_array">\n\t\t\t\t\t\t\t\t\t<template v-if="col.subEntryHref">\n\t\t\t\t\t\t\t\t\t\t<template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n\t\t\t\t\t\t\t\t\t\t\t<span v-if="sub_idx != 0">{{col | getSubSeparator}}</span>\n\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t:target="col.href_target ? col.href_target : \'_self\'"\n\t\t\t\t\t\t\t\t\t\t\t\t:href="sub_value | getSubHref(col)"\n\t\t\t\t\t\t\t\t\t\t\t\t:class="sub_value | getSubClass(col)">{{sub_value}}</a>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t<template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n\t\t\t\t\t\t\t\t\t\t\t<span v-if="sub_idx != 0">{{col | getSubSeparator}}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span :class="sub_value | getSubClass(col)">{{sub_value}}</span>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t{{entry | getValue(col)}}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>'});

/*!
  * fusionDetailsTable component v1.0.0
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const fdetails_table_header=function(){return[{title:"Feature 1",value:function(t){let n="no_feature";const e=t.features_annotation[0];return null!==e&&(n=`${e.Feature} (${e.SYMBOL})`),n}},{title:"Feature 2",value:function(t){let n="no_feature";const e=t.features_annotation[1];return null!==e&&(n=`${e.Feature} (${e.SYMBOL})`),n}},{title:"Junction type",value:function(t){let n=[];for(const e of t.features_annotation){null!==e&&n.push(e.RNA_ELT_TYPE)}return n.join(" to ")}},{title:"Frame 2 status",value:function(t){return{null:"",true:"keep_frame",false:"shift"}[t.inframe]}},{title:"Location 1",value:function(t){let n="no_feature";const e=t.features_annotation[0];if(null!==e){const t=e.RNA_ELT_TYPE.split("&")[0],o=e.RNA_ELT_POS.split("&")[0];let a=`CDS: ${e.CDS_position} and protein: ${e.Protein_position}`;e.RNA_ELT_POS.endsWith("prim")&&(a=e.RNA_ELT_POS.split("&")[1]),n=`${t} ${o} (${a})`}return n}},{title:"Location 2",value:function(t){let n="no_feature";const e=t.features_annotation[1];if(null!==e){const t=e.RNA_ELT_TYPE.split("&")[0],o=e.RNA_ELT_POS.split("&")[0];let a=`CDS: ${e.CDS_position} and protein: ${e.Protein_position}`;e.RNA_ELT_POS.endsWith("prim")&&(a=e.RNA_ELT_POS.split("&")[1]),n=`${t} ${o} (${a})`}return n}},{title:"Strand 1",value:function(t){const n=t._strand_bnd_1;let e=".";const o=t.features_annotation[0];return null!==o&&null!==o.STRAND&&(e=o.STRAND),`${n}/${e}`}},{title:"Strand 2",value:function(t){const n=t._strand_bnd_2;let e=".";const o=t.features_annotation[1];return null!==o&&null!==o.STRAND&&(e=o.STRAND),`${n}/${e}`}}]};FusionDetailsTable=Vue.component("fusion-details-table",{props:{data:{default:null,type:Object},export_title:String,filters:{default:null,type:Object},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},scroll_x:{default:!0,type:Boolean},title:{default:"Fusion detail",type:String}},computed:{header:function(){return[{title:"Feature 1",value:function(t){let n="no_feature";const e=t.features_annotation[0];return null!==e&&(n=`${e.Feature} (${e.SYMBOL})`),n}},{title:"Feature 2",value:function(t){let n="no_feature";const e=t.features_annotation[1];return null!==e&&(n=`${e.Feature} (${e.SYMBOL})`),n}},{title:"Junction type",value:function(t){let n=[];for(const e of t.features_annotation)null!==e&&n.push(e.RNA_ELT_TYPE);return n.join(" to ")}},{title:"Frame 2 status",value:function(t){return{null:"",true:"keep_frame",false:"shift"}[t.inframe]}},{title:"Location 1",value:function(t){let n="no_feature";const e=t.features_annotation[0];if(null!==e){const t=e.RNA_ELT_TYPE.split("&")[0],o=e.RNA_ELT_POS.split("&")[0];let a=`CDS: ${e.CDS_position} and protein: ${e.Protein_position}`;e.RNA_ELT_POS.endsWith("prim")&&(a=e.RNA_ELT_POS.split("&")[1]),n=`${t} ${o} (${a})`}return n}},{title:"Location 2",value:function(t){let n="no_feature";const e=t.features_annotation[1];if(null!==e){const t=e.RNA_ELT_TYPE.split("&")[0],o=e.RNA_ELT_POS.split("&")[0];let a=`CDS: ${e.CDS_position} and protein: ${e.Protein_position}`;e.RNA_ELT_POS.endsWith("prim")&&(a=e.RNA_ELT_POS.split("&")[1]),n=`${t} ${o} (${a})`}return n}},{title:"Strand 1",value:function(t){const n=t._strand_bnd_1;let e=".";const o=t.features_annotation[0];return null!==o&&null!==o.STRAND&&(e=o.STRAND),`${n}/${e}`}},{title:"Strand 2",value:function(t){const n=t._strand_bnd_2;let e=".";const o=t.features_annotation[1];return null!==o&&null!==o.STRAND&&(e=o.STRAND),`${n}/${e}`}}]},annotations:function(){let t=[];const n=this.data.breakends[0].coordinates.strand,e=this.data.breakends[1].coordinates.strand;return this.data.annotations.forEach(function(o){o._strand_bnd_1=n,o._strand_bnd_2=e,t.push(o)}),t}},template:'<dynamic-table\n            :data="annotations"\n            :export_title="export_title"\n            :header="header"\n            :menu="menu"\n            :scroll_x="scroll_x"\n            :title="title">\n        </dynamic-table>'});

/*!
  * fusionsTable component v1.2.0
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const ftable_header=function(t=!1,e={},n=null){let r=[{title:"Gene 1",is_array:!0,href_target:"_blank",subEntryHref:function(t){return`https://www.genecards.org/cgi-bin/carddisp.pl?gene=${t}`},subEntrySeparator:", ",value:function(t){return t.getSymbols(0)}},{title:"Gene 2",is_array:!0,href_target:"_blank",subEntryHref:function(t){return`https://www.genecards.org/cgi-bin/carddisp.pl?gene=${t}`},subEntrySeparator:", ",value:function(t){return t.getSymbols(1)}},{title:"Location 1",value:function(t){return t.breakends[0].coordinates.region+": "+t.breakends[0].coordinates.annot_pos}},{title:"Location 2",value:function(t){return t.breakends[1].coordinates.region+": "+t.breakends[1].coordinates.annot_pos}},{title:"Sources",is_array:!0,subEntrySeparator:", ",value:function(t){return t.sources}},{title:"Filters",is_array:!0,subEntryClass:function(t){let n=["ftable-label","ftable-label-danger"];return e.hasOwnProperty(t)&&(n=["ftable-label",e[t]]),n},value:function(t){return t.filters}},{title:"Spanning reads",typeFct:parseInt,is_array:!0,sort:"desc",entryClass:function(t){return null===n||t.supports.hasOwnProperty(n)?null:"ftable-noStdCaller"},value:function(t){let e=null;e=null!==n&&t.supports.hasOwnProperty(n)?t.supports[n]:t.supports[t.sources[0]];let r=[];return e.libraries.forEach(function(t){r.push(t.spanning_reads)}),r}},{title:"Spanning pairs",typeFct:parseInt,is_array:!0,entryClass:function(t){return null===n||t.supports.hasOwnProperty(n)?null:"ftable-noStdCaller"},value:function(t){let e=null;e=null!==n&&t.supports.hasOwnProperty(n)?t.supports[n]:t.supports[t.sources[0]];let r=[];return e.libraries.forEach(function(t){r.push(t.spanning_pairs)}),r}},{title:"Strand 1",value:function(t){const e=t.breakends[0].coordinates.strand,n=t.getStrands(0);let r=[];return t.getSymbols(0).forEach(function(t){r.push(n[t])}),e+"/"+r.join(",")}},{title:"Strand 2",value:function(t){const e=t.breakends[1].coordinates.strand,n=t.getStrands(1);let r=[];return t.getSymbols(1).forEach(function(t){r.push(n[t])}),e+"/"+r.join(",")}},{title:"Frame 2 status",value:function(t){return{null:"",true:"keep_frame",false:"shift"}[t.hasInFrame]}},{title:"Known partners",is_html:!0,value:function(t){let e=[];const n=t.getSymbols(0),r=t.getSymbols(1);return n.forEach(function(a){r.forEach(function(l){const s=a+"_@_"+l;if(t.known_partners.hasOwnProperty(s)){const a=t.known_partners[s];let l=Object.keys(a).filter(t=>"PMID"!=t);l.sort();let o="";(n.length>1||r.length>1)&&(o=s+": "),o+='<span class="ftable-label ftable-label-na">'+l.join('</span> <span class="ftable-label ftable-label-na">')+"</span> ",e.push(o)}})}),e.join(", ")}},{title:"Pubmed",is_html:!0,is_array:!0,value:function(t){let e="";const n=t.getSymbols(0),r=t.getSymbols(1);return n.forEach(function(a){r.forEach(function(l){const s=a+"_@_"+l;if(t.known_partners.hasOwnProperty(s)){const a=t.known_partners[s];if(a.hasOwnProperty("PMID")){(n.length>1||r.length>1)&&(e+=s+": ");const t=a.PMID.length;a.PMID.forEach(function(n,r){r+1<10||r+1==t?e+=`<a target="_blank" href="https://pubmed.ncbi.nlm.nih.gov/${n}">${r+1}</a> `:r+1==10&&t>10&&(e+="... ")})}}})}),e}}];return t&&r.unshift({title:"Details",event:"see-detail",is_html:!0,value:function(t){return'<button type="button" class="btn btn-primary"><i class="fa fa-eye"></i></button>'}}),r};FusionsTable=Vue.component("fusions-table",{props:{data:{default:null,type:Array},export_title:String,filters:{default:null,type:Object},filters_colors:{default:function(){return{PASS:"ftable-label-good"}},type:Object},default_source:{type:String,default:null},details_button:{default:!1,type:Boolean},pagination_sizes:{default:function(){return[5,10,25,100]},type:Array},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},title:{default:"Fusions found",type:String}},computed:{header:function(){return ftable_header(this.details_button,this.filters_colors,this.default_source)},scroll_x_fix:function(){let t=2;return this.details_button&&(t=3),t}},methods:{callDetails:function(t){this.$emit("see-detail",t)}},template:'<dynamic-table\n            v-on:see-detail="callDetails"\n            :data="data"\n            :export_title="export_title"\n            :header="header"\n            :pagination_sizes="pagination_sizes"\n            :menu="menu"\n            :scroll_x=false\n            :scroll_x_fix="scroll_x_fix"\n            :title="title">\n        </dynamic-table>'});
