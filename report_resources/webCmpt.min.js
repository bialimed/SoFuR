/*!
  * fusions v1.0.0
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
class Curation{constructor(t,s=null,n=null,e=Date.now()){this.status=t,this.date=e,this.author=s,this.description=n}static fromJSON(t){let s=new Curation(t.status);return Object.keys(t).forEach(function(n){s[n]=t[n]}),s}}class Fusion{constructor(t,s,n,e,r){this.breakends=t,this.supports=s,this.annotations=n,this.filters=e,this.curations=r}get sources(){let t=Object.keys(this.supports);return t.sort(),t}get hasInFrame(){let t={true:0,false:0,".":0};this.annotations.forEach(function(s){t[s.inframe]+=1});let s=!1;return t[!0]>0?s=!0:t["."]>0&&(s=null),s}getSymbols(t){let s=[];const n=this.breakends[t].features_by_id;for(const t in n)null!==n[t].SYMBOL&&s.push(n[t].SYMBOL);return(s=Array.from(new Set(s))).sort(),s}getStrands(t){let s={};const n=this.breakends[t].features_by_id;for(const t in n){const e=n[t].SYMBOL;null!==e&&(s[e]=n[t].STRAND)}return s}getJunctionsTypes(t){let s=[];const n=this.breakends[t];return this.annotations.forEach(function(e){const r=e.features_annotation[t];s.push(n.features_by_id[r].RNA_ELT_TYPE)}),s}getJunctionsTypesPairs(){this.getJunctionsTypes(0),this.getJunctionsTypes(1);let t=[];const s=this.breakends[0].features_by_id,n=this.breakends[1].features_by_id;return this.annotations.forEach(function(e){const r=e.features_annotation[0],o=e.features_annotation[1],a=null===r?"no_feature":s[r].RNA_ELT_TYPE,u=null===o?"no_feature":n[o].RNA_ELT_TYPE;t.push(a+" to "+u)}),(t=Array.from(new Set(t))).sort(),t}static fromJSON(t){let s={};t.hasOwnProperty("supports")&&t.supports.forEach(function(t){if(s.hasOwnProperty(t.source))throw"The source already exist '{curr_support.source}'";s[t.source]=t});let n=[];return t.hasOwnProperty("curations")&&t.curations.forEach(function(t){n.push(Curation.fromJSON(t))}),new Fusion(t.breakends,s,t.annotations,t.filters,n)}}


/*!
  * dynamicTable component v1.3.0
  * Copyright 2018 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
DynamicTable=Vue.component("dynamic-table",{props:{data:Array,filters:Object,header:{required:!0,type:Array},pagination_sizes:{default:[10,25,50,100],array:Array},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},export_title:{default:null,type:String},scroll_x:{default:!1,type:Boolean},scroll_x_fix:{default:0,type:Number},title:String},mounted:function(){$(this.$el).DataTable(this.datatableParams)},computed:{is_multi_rows_header:function(){return 0!==this.header.length&&Array.isArray(this.header[0])},nb_columns:function(){let t=0,e=this.header;return this.is_multi_rows_header&&(e=this.header[0]),e.forEach(function(e){e.hasOwnProperty("colspan")?t+=e.colspan:t+=1}),t},header_mask:function(){let t=this.header;if(this.is_multi_rows_header){const e=this.header.length,l=this.nb_columns;(t=new Array(e).fill([])).forEach(function(e,n){t[n]=new Array(l).fill(null)}),this.header.forEach(function(e,l){col_idx=0,e.forEach(function(e){for(;null!==t[l][col_idx];)col_idx+=1;colspan=e.hasOwnProperty("colspan")?e.colspan:1,rowspan=e.hasOwnProperty("rowspan")?e.rowspan:1;for(let n=l;n<l+rowspan;n++)for(let l=col_idx;l<col_idx+colspan;l++)t[n][l]=e;col_idx+=1})})}return t},columns:function(){let t=this.header_mask;return this.is_multi_rows_header&&(t=t[t.length-1]),t},filteredData:function(){let t=this.data;if(null!=this.filters){const e=this;t=t.filter(function(t){return e.filters.eval(t)})}return t},datatableParams:function(){order_rule=[[0,"asc"]],this.columns.forEach(function(t,e){t.hasOwnProperty("sort")&&(order_rule=[[e,t.sort]])});let t={dom:"",order:order_rule,lengthMenu:this.pagination_sizes};return this.scroll_x&&(t.scrollX=!0,0!=this.scroll_x_fix&&(t.fixedColumns={leftColumns:this.scroll_x_fix})),this.menu.pagination&&(this.menu.filter&&(t.dom="f"),this.menu.export?t.dom="<'d-md-none'<'row'<'col-sm-12'B><'col-sm-12'l><'col-sm-12'"+t.dom+"r>>><'d-none d-md-block'<'row'<'col-md-6'<'row'<'dtable-head-btn'B>l>><'col-md-6'"+t.dom+"r>>><'row'<'col-sm-12't>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>":t.dom="<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'"+t.dom+"r>><'row'<'col-sm-12't>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>"),this.menu.export&&(null===this.export_title?t.buttons=["csv","excel"]:t.buttons=[{extend:"csv",title:this.export_title},{extend:"excel",title:this.export_title}]),t},datatableStyle:function(){let t={};return this.scroll_x&&(t={width:"100%","border-bottom":"none"}),t}},beforeUpdate:function(){$(this.$el).DataTable().destroy()},updated:function(){$(this.$el).DataTable(this.datatableParams)},methods:{getValue:function(t,e){return this.$options.filters.getValue(t,e)}},filters:{getValue:function(t,e){let l=null;return e.hasOwnProperty("value")?l=e.value(t):t.hasOwnProperty(e.title)&&(l=t[e.title]),l},getHref:function(t,e){return e.href(t)},getClass:function(t,e){let l=null;return e.hasOwnProperty("class")&&(l=[e.class]),e.hasOwnProperty("entryClass")&&(added_class=e.entryClass(t),null===l?l=[added_class]:l.push(added_class)),l},getSubClass:function(t,e){let l=null;return e.hasOwnProperty("subEntryClass")&&(added_class=e.subEntryClass(t),null===l?l=[added_class]:l.push(added_class)),l},getSubHref:function(t,e){return e.subEntryHref(t)},getSubSeparator:function(t){let e=" ";return t.hasOwnProperty("subEntrySeparator")&&(e=t.subEntrySeparator),e},getRowSpan:function(t){return t.hasOwnProperty("rowspan")?t.rowspan:1},getColSpan:function(t){return t.hasOwnProperty("colspan")?t.colspan:1}},template:'<table class="table table-striped" :style="datatableStyle">\n\t\t\t<caption>\n\t\t\t\t{{title}}\n\t\t\t</caption>\n\t\t\t<thead>\n\t\t\t\t<template v-if="!is_multi_rows_header">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th v-for="col in columns">{{col.title}}</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<tr v-for="row in header">\n\t\t\t\t\t\t<th v-for="col in row"\n\t\t\t\t\t\t\t:rowspan="col | getRowSpan"\n\t\t\t\t\t\t\t:colspan="col | getColSpan">\n\t\t\t\t\t\t\t{{col.title}}\n\t\t\t\t\t\t</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</template>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t<tr v-for="entry in filteredData">\n\t\t\t\t\t<td v-for="(col, col_idx) in columns" :class="entry | getClass(col)">\n\t\t\t\t\t\t<template v-if="col.is_html">\n\t\t\t\t\t\t\t<span v-html="getValue(entry, col)"></span>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<template v-if="col.href">\n\t\t\t\t\t\t\t\t<a :target="col.href_target ? col.href_target : \'_self\'" :href="entry | getHref(col)">\n\t\t\t\t\t\t\t\t\t<template v-if="col.is_array">\n\t\t\t\t\t\t\t\t\t\t<template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n\t\t\t\t\t\t\t\t\t\t\t<span v-if="sub_idx != 0">{{col | getSubSeparator}}</span><span :class="sub_value | getSubClass(col)">{{sub_value}}</span>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t{{entry | getValue(col)}}\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<template v-if="col.is_array">\n\t\t\t\t\t\t\t\t\t<template v-if="col.subEntryHref">\n\t\t\t\t\t\t\t\t\t\t<template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n\t\t\t\t\t\t\t\t\t\t\t<span v-if="sub_idx != 0">{{col | getSubSeparator}}</span>\n\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t:target="col.href_target ? col.href_target : \'_self\'"\n\t\t\t\t\t\t\t\t\t\t\t\t:href="sub_value | getSubHref(col)"\n\t\t\t\t\t\t\t\t\t\t\t\t:class="sub_value | getSubClass(col)">{{sub_value}}</a>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t<template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n\t\t\t\t\t\t\t\t\t\t\t<span v-if="sub_idx != 0">{{col | getSubSeparator}}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span :class="sub_value | getSubClass(col)">{{sub_value}}</span>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t{{entry | getValue(col)}}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>'});

/*!
  * fusionsTable component v1.0.0
  * Copyright 2020 IUCT-O
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const ftable_header=function(t={},e=null){return[{title:"Gene 1",is_array:!0,href_target:"_blank",subEntryHref:function(t){return`https://www.genecards.org/cgi-bin/carddisp.pl?gene=${t}`},subEntrySeparator:", ",value:function(t){return t.getSymbols(0)}},{title:"Gene 2",is_array:!0,subEntryHref:function(t){return`https://www.genecards.org/cgi-bin/carddisp.pl?gene=${t}`},subEntrySeparator:", ",value:function(t){return t.getSymbols(1)}},{title:"Location 1",value:function(t){return t.breakends[0].coordinates.region+": "+t.breakends[0].coordinates.annot_pos}},{title:"Location 2",value:function(t){return t.breakends[1].coordinates.region+": "+t.breakends[1].coordinates.annot_pos}},{title:"Sources",is_array:!0,subEntrySeparator:", ",value:function(t){return t.sources}},{title:"Filters",is_array:!0,subEntryClass:function(e){let n=["ftable-label","ftable-label-danger"];return t.hasOwnProperty(e)&&(n=["ftable-label",t[e]]),n},value:function(t){return t.filters}},{title:"Spanning reads",typeFct:parseInt,is_array:!0,sort:"desc",entryClass:function(t){return null===e||t.supports.hasOwnProperty(e)?null:"ftable-noStdCaller"},value:function(t,e=null){let n=null;n=null!==e&&n.supports.hasOwnProperty(e)?t.supports[e]:t.supports[t.sources[0]];let r=[];return n.libraries.forEach(function(t){r.push(t.spanning_reads)}),r}},{title:"Spanning pairs",typeFct:parseInt,is_array:!0,entryClass:function(t){return null===e||t.supports.hasOwnProperty(e)?null:"ftable-noStdCaller"},value:function(t,e=null){let n=null;n=null!==e&&n.supports.hasOwnProperty(e)?t.supports[e]:t.supports[t.sources[0]];let r=[];return n.libraries.forEach(function(t){r.push(t.spanning_pairs)}),r}},{title:"Strand 1",value:function(t){const e=t.breakends[0].coordinates.strand,n=t.getStrands(0);let r=[];return t.getSymbols(0).forEach(function(t){r.push(n[t])}),e+"/"+r.join(",")}},{title:"Strand 2",value:function(t){const e=t.breakends[1].coordinates.strand,n=t.getStrands(1);let r=[];return t.getSymbols(1).forEach(function(t){r.push(n[t])}),e+"/"+r.join(",")}},{title:"Frame 2 status",value:function(t){return{null:"",true:"keep_frame",false:"shift"}[t.hasInFrame]}}]};FusionsTable=Vue.component("fusions-table",{props:{data:{default:null,type:Array},export_title:String,filters:{default:null,type:Object},filters_colors:{default:function(){return{PASS:"ftable-label-good"}},type:Object},default_source:{type:String,default:null},pagination_sizes:{default:[5,10,25,100],type:Array},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},scroll_x:{default:!0,type:Boolean},title:{default:"Fusions found",type:String}},computed:{header:function(){return ftable_header(this.filters_colors,this.default_source)}},template:'<dynamic-table\n            :data="data"\n            :export_title="export_title"\n            :header="header"\n            :pagination_sizes="pagination_sizes"\n            :menu="menu"\n            :scroll_x="scroll_x"\n            :scroll_x_fix=2\n            :title="title">\n        </dynamic-table>'});
